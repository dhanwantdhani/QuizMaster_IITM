{% extends "base.html" %}

{% block title %}Admin Dashboard - Quiz Master{% endblock %}

{% block head %}
<script src="{{ url_for('static', filename='js/admin.js') }}" defer></script>
{% endblock %}

{% block content %}
<style>
    .dashboard-header {
        background-color: #fff;
        padding: 1rem 2rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
    }

    .dashboard-title {
        font-size: 1.5rem;
        color: #2c3e50;
        margin: 0;
        font-weight: 500;
    }

    .logout-btn {
        background-color: #dc3545;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        transition: opacity 0.3s;
    }

    .logout-btn:hover {
        opacity: 0.9;
        color: white;
        text-decoration: none;
    }

    .dashboard-container {
        padding: 0 2rem 2rem 2rem;
    }

    .section-card {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
        margin-bottom: 2rem;
        border: none;
    }

    .section-header {
        padding: 1.5rem;
        border-bottom: 1px solid #e6e6e6;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .section-title {
        color: #2c3e50;
        font-size: 1.5rem;
        margin: 0;
        font-weight: 500;
    }

    .table {
        margin: 0;
    }

    .table th {
        background-color: #f8f9fa;
        border-top: none;
        color: #606266;
        font-weight: 500;
        padding: 1rem;
    }

    .table td {
        vertical-align: middle;
        padding: 1rem;
        color: #2c3e50;
    }

    .btn-add {
        background-color: #67c23a;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
    }

    .btn-edit {
        background-color: #409eff;
        color: white;
        border: none;
    }

    .btn-delete {
        background-color: #f56c6c;
        color: white;
        border: none;
    }

    .btn {
        margin: 0 0.2rem;
        padding: 0.4rem 1rem;
        font-size: 0.9rem;
        border-radius: 4px;
        transition: opacity 0.3s;
    }

    .btn:hover {
        opacity: 0.8;
        color: white;
    }

    .table-header {
        background-color: #f8f9fa;
        padding: 1rem;
        border-bottom: 1px solid #e6e6e6;
    }

    .table-column {
        padding: 0.5rem;
        text-align: left;
        font-weight: bold;
    }
</style>

<!-- Dashboard Header -->
<div class="dashboard-header">
    <h1 class="dashboard-title">
        <i class="fas fa-user-shield"></i> Admin Dashboard
    </h1>
    <a href="{{ url_for('admin_logout') }}" class="logout-btn">
        <i class="fas fa-sign-out-alt"></i> Logout
    </a>
            </div>

<div class="dashboard-container">
    <!-- Subject Management Section -->
    <div class="section-card">
        <div class="section-header">
            <h3 class="section-title">Subject Management</h3>
            <button class="btn btn-add" onclick="addSubject()">
                <i class="fas fa-plus"></i> Add Subject
            </button>
            </div>
        <div class="card-body">
            {% if subjects %}
            <div class="table-responsive">
                <table class="table">
                                <thead>
                                    <tr>
                            <th style="width: 40%">Subject Name</th>
                            <th style="width: 20%">Total Chapters</th>
                            <th style="width: 40%">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                        {% for subject in subjects %}
                        <tr>
                            <td>{{ subject.name }}</td>
                            <td>{{ subject.chapters|length }}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editSubject({{ subject.id }})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-delete" onclick="deleteSubject({{ subject.id }})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                                <button class="btn btn-add" onclick="addChapter({{ subject.id }})">
                                    <i class="fas fa-plus"></i> Add Chapter
                                </button>
                            </td>
                                    </tr>
                        {% endfor %}
                                </tbody>
                            </table>
                        </div>
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted">No subjects available. Click "Add Subject" to create your first subject.</p>
            </div>
            {% endif %}
                        </div>
                    </div>
                    
    <!-- Quiz Management Section -->
    <div class="section-card">
        <div class="section-header">
            <h3 class="section-title">Quiz Management</h3>
            <button class="btn btn-add" onclick="addQuiz()">
                <i class="fas fa-plus"></i> Add Quiz
            </button>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                            <th>Chapter</th>
                                        <th>Status</th>
                            <th>Date</th>
                            <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                        {% for quiz in quizzes %}
                        <tr>
                            <td>{{ quiz.id }}</td>
                            <td>{{ quiz.chapter.name }}</td>
                            <td>{{ quiz.status }}</td>
                            <td>{{ quiz.date.strftime('%Y-%m-%d') }}</td>
                            <td>
                                <button class="btn btn-edit" onclick="editQuiz({{ quiz.id }})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-delete" onclick="deleteQuiz({{ quiz.id }})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </td>
                                    </tr>
                        {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                </div>
                
<!-- Subject Modal -->
<div class="modal fade" id="subjectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="subjectModalLabel">Add/Edit Subject</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>
            <div class="modal-body">
                <form id="subjectForm">
                    <div class="form-group">
                        <label>Subject Name</label>
                        <input type="text" class="form-control" id="subjectName" required>
            </div>
                </form>
        </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveSubject()">Save</button>
        </div>
    </div>
</div>
        </div>
        
<!-- Add this modal for adding subjects -->
<div class="modal fade" id="addSubjectModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Subject</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
            <div class="modal-body">
                <form id="addSubjectForm">
        <div class="form-group">
                        <label for="subjectName">Subject Name</label>
                        <input type="text" class="form-control" id="subjectName" required>
        </div>
        <div class="form-group">
                        <label for="subjectDescription">Description (Optional)</label>
                        <textarea class="form-control" id="subjectDescription"></textarea>
        </div>
                </form>
        </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="submitAddSubject()">Add Subject</button>
        </div>
    </div>
</div>
        </div>
        
<script>
    // Subject Management Functions
    function addSubject() {
        $('#addSubjectModal').modal('show');
    }

    function editSubject(id) {
        // Fetch subject data and populate form
        $('#subjectModal').modal('show');
    }

    function deleteSubject(id) {
        if (confirm('Are you sure you want to delete this subject? This cannot be undone.')) {
            fetch(`/admin/subject/${id}/delete`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();  // Reload page to update UI
                } else {
                    alert('Error deleting subject: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting subject. Please try again.');
            });
        }
    }

    function viewSubject(id) {
        window.location.href = `/admin/subject/${id}`;
    }

    function addChapter(subjectId) {
        window.location.href = `/admin/subject/${subjectId}/add-chapter`;
    }

    // Quiz Management Functions
    function addQuiz() {
        window.location.href = '/admin/quiz/add';
    }

    function editQuiz(id) {
        window.location.href = `/admin/quiz/${id}/edit`;
    }

    function viewQuiz(id) {
        window.location.href = `/admin/quiz/${id}`;
    }

    function deleteQuiz(id) {
        if(confirm('Are you sure you want to delete this quiz?')) {
            fetch(`/admin/quiz/${id}/delete`, {
                method: 'DELETE',
            }).then(response => {
                if(response.ok) {
                    location.reload();
                }
            });
        }
    }

    // Function to submit new subject
    function submitAddSubject() {
        const name = document.getElementById('subjectName').value;
        const description = document.getElementById('subjectDescription').value;

        if (!name) {
            alert('Subject name is required!');
            return;
        }

        fetch('/admin/subject/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                name: name,
                description: description
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();  // Reload page to show new subject
            } else {
                alert('Error adding subject: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error adding subject. Please try again.');
        });
    }
</script>
{% endblock %} 